#!/bin/bash

LIBZRTP_VERSION="0.81.514"
ZFONE_VERSION="0.92.246"

rm -rf ./libzrtp-${LIBZRTP_VERSION} ./zfone-${ZFONE_VERSION} ./zfoned-${ZFONE_VERSION}

tar -zxvf ./libzrtp-${LIBZRTP_VERSION}.tar.gz
tar -zxvf ./zfone-${ZFONE_VERSION}.tar.gz
tar -zxvf ./zfoned-${ZFONE_VERSION}.tar.gz

echo "=========================================================================================================="
echo "========================================  CONFIGURING LIBZRTP ============================================"
echo "=========================================================================================================="

cd libzrtp-${LIBZRTP_VERSION}/projects/gnu
./autoreconf.sh
./cfg

if [ "$?" -ne "0" ]; then
    echo "Couldn't config libzrtp."
    exit 1;
fi

echo "=========================================================================================================="
echo "===========================================  MAKING LIBZRTP =============================================="
echo "=========================================================================================================="

make && make install
if [ "$?" -ne "0" ]; then
    echo "Couldn't make libzrtp."
    exit 1;
fi


echo "=========================================================================================================="
echo "========================================  CONFIGURING ZFONE GUI =========================================="
echo "=========================================================================================================="

cd ../../../zfone-${ZFONE_VERSION}
./cfg
if [ "$?" -ne "0" ]; then
    echo "Couldn't config zfone GUI."
    exit 1;
fi

echo "=========================================================================================================="
echo "===========================================  MAKING ZFONE GUI ============================================"
echo "=========================================================================================================="

make && make install
if [ "$?" -ne "0" ]; then
    echo "Couldn't make zfone GUI."
    exit 1;
fi

echo "=========================================================================================================="
echo "======================================  CONFIGURING ZFONE DAEMON ========================================="
echo "=========================================================================================================="
cd ../zfoned-${ZFONE_VERSION}
./cfg
if [ "$?" -ne "0" ]; then
    echo "Couldn't config zfone."
    exit 1;
fi

echo "=========================================================================================================="
echo "===========================================  MAKING ZFONE DAEMON ========================================="
echo "=========================================================================================================="

make && make install
if [ "$?" -ne "0" ]; then
    echo "Couldn't make zfone."
    exit 1;
fi

echo "=========================================================================================================="
echo "================================================= DONE ==================================================="
echo "=========================================================================================================="
